name:  Build & deploy
on:
  pull_request:
    branches:
      - develop
jobs:
  build:
    name: Build
    runs-on: ubuntu-latest

    steps:
       - uses: actions/checkout@v4
       - uses: actions/setup-node@v4
         with:
           node-version: '20'
       - run: npm install pnpm -g && pnpm install && pnpm build
       - run: node  scripts/deploy.js
       - run: sleep 3s
       - run: |
          export DEPLOY_DOMAIN=${{ secrets.SURGE_DOMAIN }}
          npx surge --project ./dist --domain $DEPLOY_DOMAIN --token ${{ secrets.TDESIGN_SURGE_TOKEN }}
          ls dist
          echo the preview URL is $DEPLOY_DOMAIN